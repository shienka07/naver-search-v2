name: Application Scheduler

on:
  schedule:
    # 30분마다 실행
    - cron: '*/30 * * * *'
  # 수동 실행 옵션
  workflow_dispatch:
    inputs:
      mode:
        description: '실행 모드'
        required: true
        default: 'DEFAULT'
      search_keyword:
        description: '검색 키워드'
        required: true
        default: ''

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v4
      
    - name: JDK 설정
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: IntelliJ 프로젝트 빌드
      run: |
        # IntelliJ 프로젝트 빌드 (필요에 따라 이 명령어를 조정하세요)
        # 예: Gradle이나 Maven을 사용하는 경우 해당 명령어로 변경
        mkdir -p out
        javac -d out $(find src -name "*.java")
        
    - name: Application 실행
      env:
        # GitHub Secrets에서 네이버 API 인증 정보 가져오기
        NAVER_CLIENT_ID: ${{ secrets.NAVER_CLIENT_ID }}
        NAVER_CLIENT_SECRET: ${{ secrets.NAVER_CLIENT_SECRET }}
        # GitHub 변수에서 MODE와 SEARCH_KEYWORD 가져오기
        MODE: ${{ vars.MODE }}
        SEARCH_KEYWORD: ${{ vars.SEARCH_KEYWORD }}
      run: |
        cd out
        java Application
        
    - name: 변경사항 커밋 및 푸시
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "자동 실행 결과 업데이트: ${{ github.workflow }} at $(date +'%Y-%m-%d %H:%M:%S')"
        commit_user_name: ${{ github.repository_owner }}
        commit_user_email: ${{ github.repository_owner }}@users.noreply.github.com
        commit_author: "${{ github.repository_owner }} <${{ github.repository_owner }}@users.noreply.github.com>"
        # 변경된 파일만 커밋
        add_options: '-A'
        # 변경사항이 없으면 아무 작업도 하지 않음
        skip_dirty_check: false
        # GitHub에서 기본 제공하는 토큰 사용
        token: ${{ github.token }}